<!DOCTYPE html>
<html>
<head>
    <title>Intercollege Events</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <h1>Intercollege Events</h1>

    <input type="number" id="student_id" placeholder="Enter Student ID">
    <button onclick="loadEvents()">Load Events</button>

    <div id="eventList" style="margin-top:20px;"></div>
</div>

<script>

async function loadEvents() {

    const studentId = document.getElementById("student_id").value;

    if (!studentId) {
        alert("Enter Student ID");
        return;
    }

    const interResponse = await fetch("http://127.0.0.1:8000/intercollege-events");
    const internalResponse = await fetch(
        `http://127.0.0.1:8000/internal-events?student_id=${studentId}`
    );

    const interEvents = await interResponse.json();
    const internalEvents = await internalResponse.json();

    const container = document.getElementById("eventList");
    container.innerHTML = "";

    function renderEvents(events, heading) {

        if (events.length === 0) return;

        const title = document.createElement("h2");
        title.innerText = heading;
        container.appendChild(title);

        events.forEach(event => {

            const div = document.createElement("div");
            div.style.border = "1px solid #ccc";
            div.style.padding = "10px";
            div.style.marginBottom = "10px";

            div.innerHTML = `
                <h3>${event.title}</h3>
                <p>${event.description}</p>
                <p>Date: ${event.date}</p>
                <button onclick="registerEvent(${event.id})">Register</button>
            `;

            container.appendChild(div);
        });
    }

    renderEvents(interEvents, "ğŸŒ Intercollege Events");
    renderEvents(internalEvents, "ğŸ« Internal Events");
}
async function registerEvent(eventId) {

    const studentId = document.getElementById("student_id").value;

    if (!studentId) {
        alert("Enter Student ID");
        return;
    }

    try {

        const response = await fetch(
            `http://127.0.0.1:8000/register-event?event_id=${eventId}&student_id=${studentId}`,
            { method: "POST" }
        );

        const data = await response.json();

        console.log("Backend response:", data);

        if (data.status === "success") {
            alert("Registered successfully âœ…");
        } 
        else if (data.status === "exists") {
            alert("Already registered âš ï¸");
        } 
        else {
            alert(data.message || "Registration failed âŒ");
        }

    } catch (error) {
        console.error(error);
        alert("Backend connection failed âŒ");
    }
}


</script>

</body>
</html>